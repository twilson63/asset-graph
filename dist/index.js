var n=require("ramda");function e(){return e=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},e.apply(this,arguments)}function r(n,e,o){if(!n.s){if(o instanceof t){if(!o.s)return void(o.o=r.bind(null,n,e));1&e&&(e=o.s),o=o.v}if(o&&o.then)return void o.then(r.bind(null,n,e),r.bind(null,n,2));n.s=e,n.v=o;const i=n.o;i&&i(n)}}var t=/*#__PURE__*/function(){function n(){}return n.prototype.then=function(e,t){var o=new n,i=this.s;if(i){var u=1&i?e:t;if(u){try{r(o,1,u(this.v))}catch(n){r(o,2,n)}return o}return this}return this.o=function(n){try{var i=n.v;1&n.s?r(o,1,e?e(i):i):t?r(o,1,t(i)):r(o,2,i)}catch(n){r(o,2,n)}},o},n}();function o(n){return n instanceof t&&1&n.s}var i=function(i){try{var s=!0,a=[],d="",c=function(n,e,i){for(var u;;){var s=n();if(o(s)&&(s=s.v),!s)return a;if(s.then){u=0;break}var a=i();if(a&&a.then){if(!o(a)){u=1;break}a=a.s}}var d=new t,c=r.bind(null,d,2);return(0===u?s.then(f):1===u?a.then(h):(void 0).then(function(){(s=n())?s.then?s.then(f).then(void 0,c):f(s):r(d,1,a)})).then(void 0,c),d;function h(e){a=e;do{if(!(s=n())||o(s)&&!s.v)return void r(d,1,a);if(s.then)return void s.then(f).then(void 0,c);o(a=i())&&(a=a.v)}while(!a||!a.then);a.then(h).then(void 0,c)}function f(n){n?(a=i())&&a.then?a.then(h).then(void 0,c):h(a):r(d,1,a)}}(function(){return!!s},0,function(){return Promise.resolve((r={query:i.query,variables:e({},i.variables,{cursor:d})},fetch(u+"/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(n){return n.ok?n.json():Promise.reject(n)}).then(function(n){if(n.data.errors)throw new Error(JSON.stringify(n.data.errors,null,2));return n}).then(n.path(["data","transactions"])))).then(function(n){n.edges&&n.edges.length&&(a=a.concat(n.edges),d=n.edges[n.edges.length-1].cursor),s=n.pageInfo.hasNextPage});var r});return Promise.resolve(c&&c.then?c.then(function(){return a}):a)}catch(n){return Promise.reject(n)}},u="https://arweave.net";function s(e){var r=n.compose(n.prop("value"),function(r){return n.find(n.propEq("name",r),e.tags)}),t=r("Published")?Number(r("Published")):Date.now(),o=n.join(", ",n.pluck("value",n.filter(function(n){return/^Topic:/.test(n.name)},e.tags)));return{id:e.id,type:r("Type"),title:r("Title"),description:r("Description"),metaId:r("META"),groupId:r("Group-Id"),forks:r("Forks"),published:t,stamps:0,topics:o}}function a(e){function r(e,t){return e&&e.length>0?(e.forEach(function(e){e.children=e.id===t.forks?n.append({id:t.id,group:t.groupId,node:t,children:[]},e.children):r(e.children,t)}),e):[]}return n.compose(n.reduce(function(e,t){return""===t.forks?(e.id=t.id,e.group=t.groupId,e.node=t,e.children=[]):e.children=e.id===t.forks?n.append({id:t.id,group:t.groupId,node:t,children:[]},e.children):r(e.children,t),e},{}),n.sortBy(n.prop("published")),n.reject(n.propEq("forks",void 0)))(e)}function d(e){return i({query:'query ($groupIds: [String!]!, $cursor: String) {\n      transactions(first: 100, after: $cursor, tags: [\n        { name: "Group-Id", values: $groupIds }\n       ]) {\n        pageInfo {\n          hasNextPage\n        }\n        edges {\n          cursor\n          node {\n            id \n            tags {\n              name\n              value\n            }\n          }\n        }\n      }\n    }',variables:{groupIds:[e]}}).then(n.map(n.compose(s,n.prop("node"))))}module.exports=function(e){try{return Promise.resolve(function(e){return function(n){return Promise.resolve({query:"query ($ids: [ID!], $cursor: String) {\n      transactions(first: 1, after: $cursor, \n        ids: $ids) {\n        pageInfo {\n          hasNextPage\n        }\n        edges {\n          cursor\n          node {\n            id\n            tags {\n              name\n              value\n            }\n          }\n        }\n      }\n    }",variables:{ids:[n]}})}(e).then(i).then(n.compose(n.prop("node"),n.head)).then(s)}(e).then(n.prop("groupId")).then(d).then(a))}catch(n){return Promise.reject(n)}};
//# sourceMappingURL=index.js.map
