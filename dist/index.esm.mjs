import{path as n,prop as e,compose as r,head as t,find as i,propEq as o,join as u,pluck as s,filter as a,reduce as d,sortBy as c,reject as h,map as f,append as l}from"ramda";function v(){return v=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},v.apply(this,arguments)}function g(n,e,r){if(!n.s){if(r instanceof p){if(!r.s)return void(r.o=g.bind(null,n,e));1&e&&(e=r.s),r=r.v}if(r&&r.then)return void r.then(g.bind(null,n,e),g.bind(null,n,2));n.s=e,n.v=r;const t=n.o;t&&t(n)}}var p=/*#__PURE__*/function(){function n(){}return n.prototype.then=function(e,r){var t=new n,i=this.s;if(i){var o=1&i?e:r;if(o){try{g(t,1,o(this.v))}catch(n){g(t,2,n)}return t}return this}return this.o=function(n){try{var i=n.v;1&n.s?g(t,1,e?e(i):i):r?g(t,1,r(i)):g(t,2,i)}catch(n){g(t,2,n)}},t},n}();function b(n){return n instanceof p&&1&n.s}var y=function(e){try{var r=!0,t=[],i="",o=function(n,e,r){for(var t;;){var i=n();if(b(i)&&(i=i.v),!i)return o;if(i.then){t=0;break}var o=r();if(o&&o.then){if(!b(o)){t=1;break}o=o.s}}var u=new p,s=g.bind(null,u,2);return(0===t?i.then(d):1===t?o.then(a):(void 0).then(function(){(i=n())?i.then?i.then(d).then(void 0,s):d(i):g(u,1,o)})).then(void 0,s),u;function a(e){o=e;do{if(!(i=n())||b(i)&&!i.v)return void g(u,1,o);if(i.then)return void i.then(d).then(void 0,s);b(o=r())&&(o=o.v)}while(!o||!o.then);o.then(a).then(void 0,s)}function d(n){n?(o=r())&&o.then?o.then(a).then(void 0,s):a(o):g(u,1,o)}}(function(){return!!r},0,function(){return Promise.resolve((o={query:e.query,variables:v({},e.variables,{cursor:i})},fetch(m+"/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(function(n){return n.ok?n.json():Promise.reject(n)}).then(function(n){if(n.data.errors)throw new Error(JSON.stringify(n.data.errors,null,2));return n}).then(n(["data","transactions"])))).then(function(n){n.edges&&n.edges.length&&(t=t.concat(n.edges),i=n.edges[n.edges.length-1].cursor),r=n.pageInfo.hasNextPage});var o});return Promise.resolve(o&&o.then?o.then(function(){return t}):t)}catch(n){return Promise.reject(n)}},m="https://arweave.net",I=function(n){try{return Promise.resolve(function(n){return function(n){return Promise.resolve({query:"query ($ids: [ID!], $cursor: String) {\n      transactions(first: 1, after: $cursor, \n        ids: $ids) {\n        pageInfo {\n          hasNextPage\n        }\n        edges {\n          cursor\n          node {\n            id\n            tags {\n              name\n              value\n            }\n          }\n        }\n      }\n    }",variables:{ids:[n]}})}(n).then(y).then(r(e("node"),t)).then(P)}(n).then(e("groupId")).then(j).then(k))}catch(n){return Promise.reject(n)}};function P(n){var t=r(e("value"),function(e){return i(o("name",e),n.tags)}),d=t("Published")?Number(t("Published")):Date.now(),c=u(", ",s("value",a(function(n){return/^Topic:/.test(n.name)},n.tags)));return{id:n.id,type:t("Type"),title:t("Title"),description:t("Description"),metaId:t("META"),groupId:t("Group-Id"),forks:t("Forks"),published:d,stamps:0,topics:c}}function k(n){function t(n,e){return n&&n.length>0?(n.forEach(function(n){n.children=n.id===e.forks?l({id:e.id,group:e.groupId,node:e,children:[]},n.children):t(n.children,e)}),n):[]}return r(d(function(n,e){return""===e.forks?(n.id=e.id,n.group=e.groupId,n.node=e,n.children=[]):n.children=n.id===e.forks?l({id:e.id,group:e.groupId,node:e,children:[]},n.children):t(n.children,e),n},{}),c(e("published")),h(o("forks",void 0)))(n)}function j(n){return y({query:'query ($groupIds: [String!]!, $cursor: String) {\n      transactions(first: 100, after: $cursor, tags: [\n        { name: "Group-Id", values: $groupIds }\n       ]) {\n        pageInfo {\n          hasNextPage\n        }\n        edges {\n          cursor\n          node {\n            id \n            tags {\n              name\n              value\n            }\n          }\n        }\n      }\n    }',variables:{groupIds:[n]}}).then(f(r(P,e("node"))))}export{I as default};
//# sourceMappingURL=index.esm.mjs.map
